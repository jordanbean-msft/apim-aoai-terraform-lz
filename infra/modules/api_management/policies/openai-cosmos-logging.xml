<fragment>
    <authentication-managed-identity 
    resource="{{cosmosdb-scope}}" 
    output-token-variable-name="msi-access-token" 
    ignore-error="false"
    client-id="{{user-assigned-identity-client-id}}" />    
    <send-one-way-request mode="new">
        <set-url>{{cosmosdb-document-endpoint}}</set-url>
        <set-method>POST</set-method>
        <set-header name="Authorization" exists-action="override">
            <value>@("type=aad&amp;ver=1.0&amp;sig=" + context.Variables["msi-access-token"])</value>
        </set-header>
        <set-body>@{
            return new JObject(
                new JProperty("id", context.RequestId),
                new JProperty("timestamp", DateTime.UtcNow.ToString("yyyy-MM-ddTHH:mm:ss.fffZ")),
                new JProperty("api-key", context.Subscription.Id)
            ).ToString();
        }
        </set-body>
    </send-one-way-request>
</fragment>